<h1> Liste des livres </h1>
<div id="confirm-modal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Confirmation de suppression</h4>
      </div>
      <div class="modal-body">
        <p>Voullez-vous vraiment supprimer ce livre ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-danger" id="remove">Supprimer</button>
      </div>
    </div> 
  </div>
</div>

<table class="table table-bordered table-striped" id="booksTable">
  <thead>
    <th>Titre</th>
    <th>Prix</th>
    <th>Résumé</th>
    <th></th>
  </thead>
  <tbody></tbody>
</table>
<script type="text/javascript">
  var bTable = null;
  function updateListBooks(){    
    var books = ws.callMethod('allBooks', []);
    var txt = '';
    if($.isArray(books)){
      books.forEach(function(b){
        txt += '<tr><td>'+b.title+'</td><td>'+b.price+' €</td><td>'+b.resume+'</td><td>';
        txt += '<a href="index.html#p:book_details|n:'+b.num+'" class="btn btn-primary"><span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
        txt += '<a href="index.html#p:book_edit|n:'+b.num+'" class="btn btn-success"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>';
        txt += '<button book-num="'+b.num+'" class="btn btn-danger book_remove"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>';
        txt += '</td></tr>';
      });
    } else if(books){
      txt += '<tr><td>'+books.title+'</td><td>'+books.price+' €</td><td>'+books.resume+'</td><td>';
      txt += '<a href="index.html#p:book_details|n:'+books.num+'" class="btn btn-primary"><span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
      txt += '<a href="index.html#p:book_edit|n:'+books.num+'" class="btn btn-success"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>';
      txt += '<button book-num="'+books.num+'" class="btn btn-danger book_remove"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>';
      txt += '</td></tr>';
    } else {
      txt = '<tr><td colspan="4"> Aucun livre ! </td></tr>'
    }

    $('#booksTable > tbody').html(txt);

    if(bTable == null){
      bTable = $('#booksTable').DataTable({
        "language": {
          "url": "json/datatable.json"
        }
      });
    }

    $('.book_remove').click(function(){
      bookNum = $(this).attr('book-num');
      $('#confirm-modal').modal('show');
    });
  }
  var bookNum;
  $('#remove').click(function(){
    $('#confirm-modal').modal('hide');
    var flag = ws.callMethod('deleteBook', [bookNum]);
    if(flag){
      updateListBooks();
      reloadSideBar();
    }
  });
  updateListBooks();
</script>